# MCP Setup Command

> Generates MCP server configuration based on PROJECT_STARTER.md selections

## Purpose

This command reads the MCP Configuration section in PROJECT_STARTER.md and:

1. Parses enabled MCP servers (marked as `TRUE`)
2. Generates Claude Code MCP configuration
3. Creates `.env.example` with required environment variables
4. Provides setup instructions for each enabled MCP
5. Validates configuration requirements

## Usage

```bash
/mcp-setup
```

Or with options:

```bash
/mcp-setup --output-only  # Just generate config, don't update files
/mcp-setup --validate     # Validate existing MCP configuration
```

## Process

### Step 1: Parse PROJECT_STARTER.md

Read the MCP Configuration section and identify all MCPs marked as `TRUE`:

```markdown
## MCP Configuration

### Database & Storage

- **Neon Database**: `TRUE`
- **Supabase**: `FALSE`
```

Extract:
- MCP name
- Category
- Status (TRUE/FALSE)

### Step 2: Load MCP Provider Configurations

For each enabled MCP, load its configuration from `.claude/mcp/providers/[mcp-name].json`:

```json
{
  "name": "neon",
  "displayName": "Neon Database",
  "category": "database",
  "command": "npx",
  "args": ["-y", "@neondatabase/mcp-server-neon"],
  "env": {
    "NEON_API_KEY": "${NEON_API_KEY}"
  },
  "requiredEnvVars": ["NEON_API_KEY"],
  "documentation": "https://github.com/neondatabase/mcp-server-neon",
  "setup": ".claude/mcp/providers/neon-setup.md"
}
```

### Step 3: Generate Claude Code Configuration

Create or update `.claude/mcp-config.json`:

```json
{
  "mcpServers": {
    "neon": {
      "command": "npx",
      "args": ["-y", "@neondatabase/mcp-server-neon"],
      "env": {
        "NEON_API_KEY": "${NEON_API_KEY}"
      }
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_TOKEN": "${GITHUB_TOKEN}"
      }
    }
  }
}
```

### Step 4: Generate Environment Variables Template

Create or update `.env.example`:

```bash
# MCP Configuration - Generated by /mcp-setup

# Neon Database
NEON_API_KEY=your_neon_api_key_here

# GitHub
GITHUB_TOKEN=your_github_token_here

# Cloudflare
CLOUDFLARE_API_TOKEN=your_cloudflare_token_here

# Sentry
SENTRY_AUTH_TOKEN=your_sentry_token_here

# Stripe
STRIPE_SECRET_KEY=your_stripe_secret_key_here

# Google Analytics 4
GA4_MEASUREMENT_ID=your_ga4_measurement_id_here
```

### Step 5: Generate Setup Instructions

Create `MCP_SETUP.md` with provider-specific instructions:

```markdown
# MCP Setup Instructions

## Enabled MCP Servers

The following MCP servers have been configured for your project:

### 1. Neon Database

**Purpose:** PostgreSQL database operations, migrations, query tuning

**Setup:**
1. Sign up at https://neon.tech
2. Create a project
3. Generate API key from Account Settings
4. Add to `.env`: `NEON_API_KEY=your_key_here`

**Required Environment Variables:**
- `NEON_API_KEY`

**Documentation:** https://github.com/neondatabase/mcp-server-neon

---

### 2. GitHub

**Purpose:** Repository operations, issues, PRs, CI/CD

**Setup:**
1. Go to https://github.com/settings/tokens
2. Generate a new token with repo permissions
3. Add to `.env`: `GITHUB_TOKEN=your_token_here`

**Required Environment Variables:**
- `GITHUB_TOKEN`

**Documentation:** https://github.com/modelcontextprotocol/servers
```

### Step 6: Validate Configuration

Check for:
- Required environment variables are documented
- MCP providers are available (npm packages exist)
- No conflicting configurations
- Valid JSON syntax

### Step 7: Output Results

Display summary:

```
‚úÖ MCP Configuration Generated

Enabled MCPs: 6
- Neon Database
- Cloudflare
- GitHub
- Sentry
- Stripe
- Google Analytics 4

Files Created/Updated:
- .claude/mcp-config.json
- .env.example
- MCP_SETUP.md

Next Steps:
1. Copy .env.example to .env
2. Fill in your API keys and tokens
3. Follow setup instructions in MCP_SETUP.md
4. Restart Claude Code to load MCP servers
```

## Configuration Files

### MCP Provider Definition

Each MCP provider has a JSON configuration file in `.claude/mcp/providers/`:

```json
{
  "name": "provider-name",
  "displayName": "Provider Display Name",
  "category": "database|infrastructure|development|communication|analytics|payments|ai|content|search",
  "command": "npx|node|python",
  "args": ["package-name", "...additional-args"],
  "env": {
    "ENV_VAR_NAME": "${ENV_VAR_NAME}"
  },
  "requiredEnvVars": ["ENV_VAR_NAME"],
  "optionalEnvVars": ["OPTIONAL_VAR"],
  "documentation": "https://docs-url",
  "setup": ".claude/mcp/providers/provider-setup.md",
  "features": [
    "Feature 1",
    "Feature 2"
  ],
  "agentIntegration": {
    "categories": ["code-generation", "task-automation"],
    "examples": "path/to/examples.md"
  }
}
```

## Command Options

### `--output-only`

Generate configuration but don't write files:

```bash
/mcp-setup --output-only
```

Outputs JSON to console without creating files.

### `--validate`

Validate existing MCP configuration:

```bash
/mcp-setup --validate
```

Checks:
- All enabled MCPs have valid configurations
- Environment variables are defined
- No syntax errors in config files
- Required packages are available

### `--list`

List all available MCP providers:

```bash
/mcp-setup --list
```

Shows all providers with status (enabled/disabled).

### `--add [provider]`

Add a specific MCP provider:

```bash
/mcp-setup --add stripe
```

Adds provider to configuration and updates PROJECT_STARTER.md.

### `--remove [provider]`

Remove a specific MCP provider:

```bash
/mcp-setup --remove stripe
```

Removes provider from configuration and updates PROJECT_STARTER.md.

## Error Handling

### Missing Provider Configuration

If an enabled MCP doesn't have a provider file:

```
‚ùå Error: No configuration found for "custom-mcp"

Available options:
1. Add provider configuration in .claude/mcp/providers/custom-mcp.json
2. Disable this MCP in PROJECT_STARTER.md
3. Use --skip-validation to generate anyway
```

### Invalid Environment Variables

If required environment variables are missing:

```
‚ö†Ô∏è  Warning: Missing environment variables for enabled MCPs

Missing for Neon:
- NEON_API_KEY

Please update your .env file before using these MCPs.
```

### Package Not Available

If npm package doesn't exist:

```
‚ö†Ô∏è  Warning: Package not found: @custom/mcp-server

The MCP server package may not be published yet.
Configuration generated but manual installation may be required.
```

## Integration with Agents

After MCP setup, agents can leverage configured MCPs:

```markdown
## Example: Database Model Generator with Neon

If Neon MCP is enabled, the code-generation agents can:
- Query actual database schema
- Generate models matching existing tables
- Create type-safe migrations
- Validate generated code against constraints
```

## Troubleshooting

### Configuration Not Loading

1. Verify `.claude/mcp-config.json` exists
2. Check for syntax errors: `cat .claude/mcp-config.json | jq .`
3. Restart Claude Code

### Environment Variables Not Found

1. Ensure `.env` file exists in project root
2. Verify variable names match exactly
3. Restart Claude Code to reload environment

### MCP Server Fails to Start

1. Check logs: Look for MCP error messages
2. Verify npm package is available: `npm info @package/name`
3. Test command manually: `npx @package/name`
4. Check API keys are valid

## Examples

### Example 1: Enable Neon and GitHub

PROJECT_STARTER.md:
```markdown
- **Neon Database**: `TRUE`
- **GitHub**: `TRUE`
```

Run:
```bash
/mcp-setup
```

Result:
- 2 MCPs configured
- .env.example with NEON_API_KEY and GITHUB_TOKEN
- Setup instructions generated

### Example 2: Full Stack with Analytics

Enable:
- Neon Database
- Cloudflare
- GitHub
- Sentry
- Stripe
- Google Analytics 4

Run:
```bash
/mcp-setup
```

Result:
- 6 MCPs configured
- Complete development, deployment, and monitoring stack
- Integrated error tracking and analytics

### Example 3: Add Custom MCP

1. Create `.claude/mcp/providers/custom.json`
2. Set `**Custom**: TRUE` in PROJECT_STARTER.md
3. Run `/mcp-setup`

## Output Format

### Success Output

```
üéâ MCP Configuration Complete

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üì¶ Enabled MCPs (6):
  ‚úì Neon Database         (database)
  ‚úì Cloudflare           (infrastructure)
  ‚úì GitHub               (development)
  ‚úì Sentry               (monitoring)
  ‚úì Stripe               (payments)
  ‚úì Google Analytics 4   (analytics)

üìù Generated Files:
  ‚Üí .claude/mcp-config.json
  ‚Üí .env.example
  ‚Üí MCP_SETUP.md

üîë Environment Variables Required: 6
  - NEON_API_KEY
  - CLOUDFLARE_API_TOKEN
  - GITHUB_TOKEN
  - SENTRY_AUTH_TOKEN
  - STRIPE_SECRET_KEY
  - GA4_MEASUREMENT_ID

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Next Steps:
1. Copy .env.example to .env
2. Add your API keys (see MCP_SETUP.md for details)
3. Restart Claude Code
4. Verify with: /mcp-setup --validate

Documentation: ./MCP_SETUP.md
```

### Validation Output

```
üîç Validating MCP Configuration...

‚úì Configuration file valid
‚úì All enabled MCPs have configurations
‚úì Environment variables documented
‚ö† Missing .env file (using .env.example as reference)

Status: 6/6 MCPs properly configured
```

## Notes

- MCP configuration is project-specific
- API keys should never be committed to git
- Add `.env` to `.gitignore`
- Use `.env.example` as template for team members
- Update PROJECT_STARTER.md when adding/removing MCPs
- Restart Claude Code after configuration changes

---

*This command streamlines MCP setup and ensures all team members have consistent configuration.*
