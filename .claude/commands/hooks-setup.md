# Hooks Setup Command

> Generates hook configuration based on PROJECT_STARTER.md selections

## Purpose

This command reads the Hooks Configuration section in PROJECT_STARTER.md and:

1. Parses enabled hooks (marked as `TRUE`)
2. Generates hook configuration files
3. Installs git hooks where applicable
4. Creates hook execution scripts
5. Configures hook settings

## Usage

```bash
/hooks-setup
```

Or with options:

```bash
/hooks-setup --output-only  # Just generate config, don't install
/hooks-setup --validate     # Validate existing hook configuration
/hooks-setup --uninstall    # Remove all installed hooks
```

## Process

### Step 1: Parse PROJECT_STARTER.md

Read the Hooks Configuration section and identify all hooks marked as `TRUE`:

```markdown
## Hooks Configuration

### Git Hooks

- **Pre-Commit Validation**: `TRUE`
- **Commit Message Validation**: `TRUE`
```

Extract:

- Hook name
- Category
- Status (TRUE/FALSE)

### Step 2: Load Hook Definitions

For each enabled hook, load its configuration from
`.claude/hooks/definitions/[hook-name].json`:

```json
{
  "name": "pre-commit-validation",
  "displayName": "Pre-Commit Validation",
  "category": "git",
  "trigger": "pre-commit",
  "script": ".claude/hooks/scripts/pre-commit-validation.sh",
  "actions": [
    {
      "name": "lint",
      "command": "npm run lint",
      "continueOnError": false
    },
    {
      "name": "format-check",
      "command": "npm run format:check",
      "continueOnError": false
    },
    {
      "name": "type-check",
      "command": "npm run type-check",
      "continueOnError": false
    }
  ],
  "settings": {
    "failOnError": true,
    "skipCIEnvironment": false,
    "timeout": 30000
  }
}
```

### Step 3: Generate Hook Configuration

Create or update `.claude/hooks/config.json`:

```json
{
  "enabled": true,
  "hooks": {
    "git": {
      "pre-commit-validation": {
        "enabled": true,
        "actions": ["lint", "format-check", "type-check"],
        "failOnError": true
      },
      "commit-message-validation": {
        "enabled": true,
        "pattern": "^(feat|fix|docs|style|refactor|test|chore):\\s.+",
        "failOnError": true
      }
    },
    "file": {
      "auto-format-on-save": {
        "enabled": true,
        "extensions": [".js", ".ts", ".tsx", ".jsx"],
        "formatter": "prettier"
      },
      "auto-import-sort": {
        "enabled": true,
        "extensions": [".js", ".ts", ".tsx", ".jsx"]
      }
    }
  }
}
```

### Step 4: Install Git Hooks

For git hooks, install into `.git/hooks/`:

```bash
#!/bin/sh
# .git/hooks/pre-commit
# Generated by /hooks-setup

# Load hook configuration
HOOK_CONFIG=".claude/hooks/config.json"

if [ ! -f "$HOOK_CONFIG" ]; then
  echo "Hook configuration not found"
  exit 0
fi

# Execute pre-commit validation
node .claude/hooks/scripts/run-hook.js pre-commit

exit $?
```

### Step 5: Create Hook Scripts

Generate execution scripts for each hook:

```javascript
// .claude/hooks/scripts/run-hook.js
const fs = require('fs');
const { execSync } = require('child_process');

const hookName = process.argv[2];
const config = JSON.parse(fs.readFileSync('.claude/hooks/config.json', 'utf8'));

// Find hook configuration
const hookConfig = findHookConfig(config, hookName);

if (!hookConfig || !hookConfig.enabled) {
  process.exit(0);
}

// Execute hook actions
for (const action of hookConfig.actions) {
  try {
    console.log(`Running ${action.name}...`);
    execSync(action.command, { stdio: 'inherit' });
  } catch (error) {
    if (!action.continueOnError && hookConfig.failOnError) {
      console.error(`${action.name} failed`);
      process.exit(1);
    }
  }
}

process.exit(0);
```

### Step 6: Configure IDE Hooks

For file hooks (on-save), generate IDE-specific configurations:

**VSCode (.vscode/settings.json):**

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": true
  }
}
```

**JetBrains (.idea/watcherTasks.xml):**

```xml
<TaskOptions>
  <option name="name" value="Format on Save" />
  <option name="description" value="Auto-format files on save" />
</TaskOptions>
```

### Step 7: Output Results

Display summary:

```
Hook Configuration Complete

Enabled Hooks: 6
├─ Git Hooks (2)
│  ├─ Pre-Commit Validation
│  └─ Commit Message Validation
├─ File Hooks (2)
│  ├─ Auto Format on Save
│  └─ Auto Import Sort
└─ Agent Hooks (2)
   ├─ Task Completion Notifications
   └─ Agent Error Handling

Files Created/Updated:
- .claude/hooks/config.json
- .git/hooks/pre-commit
- .git/hooks/commit-msg
- .vscode/settings.json (optional)

Next Steps:
1. Test hooks with: git commit -m "test: hook validation"
2. Configure hook settings in .claude/hooks/config.json
3. Add hook-specific configuration as needed
```

## Hook Categories

### Git Hooks

Triggered by git operations:

- **pre-commit**: Before commits are created
- **pre-push**: Before pushing to remote
- **commit-msg**: Validate commit messages
- **post-commit**: After commits are created
- **pre-rebase**: Before rebasing

### File Hooks

Triggered by file system events:

- **on-save**: When files are saved
- **on-create**: When files are created
- **on-delete**: When files are deleted
- **on-rename**: When files are renamed

### Build Hooks

Triggered during build process:

- **pre-build**: Before build starts
- **post-build**: After build completes
- **build-error**: When build fails

### Deployment Hooks

Triggered during deployment:

- **pre-deploy**: Before deployment starts
- **post-deploy**: After deployment completes
- **deploy-error**: When deployment fails
- **rollback**: During rollback operations

### Agent Hooks

Triggered by agent operations:

- **task-start**: When agent task starts
- **task-complete**: When agent task completes
- **task-error**: When agent task fails
- **agent-timeout**: When agent times out

## Command Options

### `--output-only`

Generate configuration but don't install:

```bash
/hooks-setup --output-only
```

### `--validate`

Validate existing hook configuration:

```bash
/hooks-setup --validate
```

Checks:

- All enabled hooks have valid configurations
- Git hooks are properly installed
- Scripts are executable
- No syntax errors in config files

### `--uninstall`

Remove all installed hooks:

```bash
/hooks-setup --uninstall
```

Removes:

- Git hooks from `.git/hooks/`
- Hook configuration files
- Generated scripts

### `--list`

List all available hooks:

```bash
/hooks-setup --list
```

Shows all hooks with status (enabled/disabled).

### `--enable [hook]`

Enable a specific hook:

```bash
/hooks-setup --enable pre-commit-validation
```

### `--disable [hook]`

Disable a specific hook:

```bash
/hooks-setup --disable pre-commit-validation
```

## Hook Configuration

Each hook has a JSON configuration file:

```json
{
  "name": "hook-name",
  "displayName": "Hook Display Name",
  "category": "git|file|build|deployment|agent",
  "trigger": "event-name",
  "description": "What this hook does",
  "script": "path/to/script.sh",
  "actions": [
    {
      "name": "action-name",
      "command": "command to run",
      "continueOnError": false,
      "timeout": 30000
    }
  ],
  "settings": {
    "failOnError": true,
    "skipCIEnvironment": false,
    "parallel": false
  },
  "files": {
    "include": ["src/**/*.ts"],
    "exclude": ["**/*.test.ts"]
  }
}
```

## Examples

### Example 1: Basic Git Hooks

Enable pre-commit validation and commit message validation:

```markdown
- **Pre-Commit Validation**: `TRUE`
- **Commit Message Validation**: `TRUE`
```

Run:

```bash
/hooks-setup
```

Result:

- Lint, format, and type-check before commits
- Enforce conventional commit messages

### Example 2: Auto-Formatting

Enable auto-formatting on save:

```markdown
- **Auto Format on Save**: `TRUE`
- **Auto Import Sort**: `TRUE`
```

Result:

- Code automatically formatted on save
- Imports sorted and organized

### Example 3: Full CI/CD Pipeline

Enable all deployment hooks:

```markdown
- **Pre-Deploy Checks**: `TRUE`
- **Post-Deploy Verification**: `TRUE`
- **Deployment Notifications**: `TRUE`
- **Rollback on Failure**: `TRUE`
```

Result:

- Comprehensive deployment automation
- Automated rollback on failures
- Team notifications

## Troubleshooting

### Hooks Not Running

**Check:**

1. Verify hooks are enabled in config.json
2. Ensure git hooks are executable: `chmod +x .git/hooks/*`
3. Check hook scripts exist
4. Validate configuration: `/hooks-setup --validate`

### Hook Failing

**Debug:**

1. Run hook manually to see errors
2. Check action commands are valid
3. Verify required dependencies are installed
4. Review hook logs

### IDE Integration Not Working

**Solutions:**

1. Restart IDE to reload settings
2. Check IDE-specific configuration files
3. Verify IDE supports the hook type
4. Manual configuration may be needed

## Security Considerations

### Hook Safety

- Review hook actions before enabling
- Avoid hooks that execute untrusted code
- Limit hook permissions
- Validate hook configurations

### Sensitive Data

- Don't include secrets in hook configs
- Use environment variables for credentials
- Be cautious with pre-push hooks accessing remote

## Best Practices

### Start Simple

Begin with essential hooks:

```markdown
- **Pre-Commit Validation**: `TRUE`
- **Auto Format on Save**: `TRUE`
```

Add more as needed.

### Test Hooks

Always test hooks before relying on them:

```bash
# Test git hooks
git commit --allow-empty -m "test: hook validation"

# Test with /hooks-setup --validate
/hooks-setup --validate
```

### Performance

- Keep hook actions fast (< 5 seconds)
- Use parallel execution where possible
- Cache results when appropriate
- Skip heavy operations in CI environments

### Team Coordination

- Document custom hooks in README
- Share hook configurations via git
- Ensure team has required tools installed
- Provide hook bypass instructions for emergencies

## Emergency Bypass

To temporarily bypass hooks:

```bash
# Skip git hooks
git commit --no-verify -m "emergency: bypass hooks"

# Disable all hooks temporarily
/hooks-setup --disable-all

# Re-enable
/hooks-setup
```

## Integration with CI/CD

Hooks can detect CI environments and adjust behavior:

```json
{
  "settings": {
    "skipCIEnvironment": true,
    "ciDetection": ["CI", "GITHUB_ACTIONS", "GITLAB_CI"]
  }
}
```

## Notes

- Hook configuration is project-specific
- Git hooks are not committed (in `.git/hooks/`)
- Hook configs ARE committed (in `.claude/hooks/`)
- Team members run `/hooks-setup` to install hooks
- Update PROJECT_STARTER.md when changing hook needs

---

_This command automates hook setup and ensures consistent development workflows
across the team._
